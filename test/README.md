# LibRaw æµ‹è¯•å¥—ä»¶

LibRaw Node.js åŒ…è£…å™¨çš„ç»¼åˆæµ‹è¯•æ¡†æ¶ã€‚

## æµ‹è¯•æ¦‚è¿°

æµ‹è¯•å¥—ä»¶åŒ…æ‹¬å¯¹æ‰€æœ‰ LibRaw åŠŸèƒ½çš„å…¨é¢è¦†ç›–ï¼š

### ğŸ§ª æµ‹è¯•ç±»åˆ«

1. **é™æ€æ–¹æ³•**ï¼ˆ`static-methods.test.js`ï¼‰

   - åº“ç‰ˆæœ¬å’ŒåŠŸèƒ½
   - ç›¸æœºåˆ—è¡¨å’Œè®¡æ•°éªŒè¯
   - åŠŸèƒ½æ ‡å¿—åˆ†æ

2. **é”™è¯¯å¤„ç†**ï¼ˆ`error-handling.test.js`ï¼‰

   - æ— æ•ˆæ–‡ä»¶åŠ è½½åœºæ™¯
   - å‚æ•°éªŒè¯
   - å†…å­˜ç®¡ç†è¾¹ç¼˜æƒ…å†µ
   - ä¼˜é›…çš„é”™è¯¯æ¢å¤

3. **ç¼“å†²åŒºæ“ä½œ**ï¼ˆ`buffer-operations.test.js`ï¼‰

   - æ–‡ä»¶ä¸ç¼“å†²åŒºåŠ è½½æ¯”è¾ƒ
   - å†…å­˜ç®¡ç†å‹åŠ›æµ‹è¯•
   - ç¼“å†²åŒºå¤§å°å’Œå†…å®¹éªŒè¯
   - è§’è½æƒ…å†µå¤„ç†

4. **ç¼“å†²åŒºåˆ›å»º**ï¼ˆ`buffer-creation.test.js`ï¼‰

   - å…·æœ‰è´¨é‡é€‰é¡¹çš„ JPEG ç¼“å†²åŒºåˆ›å»º
   - å…·æœ‰å‹ç¼©çº§åˆ«çš„ PNG ç¼“å†²åŒºåˆ›å»º
   - WebP ç¼“å†²åŒºåˆ›å»ºï¼ˆæœ‰æŸå’Œæ— æŸï¼‰
   - AVIF ç¼“å†²åŒºåˆ›å»ºï¼ˆä¸‹ä¸€ä»£æ ¼å¼ï¼‰
   - å…·æœ‰å‹ç¼©é€‰é¡¹çš„ TIFF ç¼“å†²åŒºåˆ›å»º
   - PPM ç¼“å†²åŒºåˆ›å»ºï¼ˆåŸå§‹æ ¼å¼ï¼‰
   - ç¼©ç•¥å›¾ JPEG æå–
   - å¹¶è¡Œæ ¼å¼åˆ›å»º
   - æ€§èƒ½åŸºå‡†æµ‹è¯•

5. **ç¼“å†²åŒºè¾¹ç¼˜æƒ…å†µ**ï¼ˆ`buffer-edge-cases.test.js`ï¼‰

   - å‹åŠ›ä¸‹çš„å†…å­˜ç®¡ç†
   - æç«¯å‚æ•°éªŒè¯
   - å¤šä¸ªå¤„ç†å™¨å®ä¾‹
   - æ ¼å¼éªŒè¯å’Œé­”æœ¯å­—èŠ‚
   - èµ„æºæ¸…ç†éªŒè¯

6. **é…ç½®**ï¼ˆ`configuration.test.js`ï¼‰

   - è¾“å‡ºå‚æ•°è®¾ç½®/è·å–
   - å‚æ•°éªŒè¯å’ŒèŒƒå›´
   - çœŸå®ä¸–ç•Œé…ç½®åœºæ™¯

7. **ç»¼åˆ**ï¼ˆ`comprehensive.test.js`ï¼‰
   - ç«¯åˆ°ç«¯å¤„ç†ç®¡é“
   - æ‰€æœ‰ API æ–¹æ³•æ¼”ç¤º
   - çœŸå®æ–‡ä»¶å¤„ç†

## ç¼“å†²åŒºåˆ›å»ºæµ‹è¯•

### æ–°ç¼“å†²åŒº API æµ‹è¯•

æµ‹è¯•å¥—ä»¶åŒ…æ‹¬å¯¹æ–°ç¼“å†²åŒºåˆ›å»ºæ–¹æ³•çš„å…¨é¢æµ‹è¯•ï¼š

#### **å¿«é€Ÿç¼“å†²åŒºéªŒè¯**ï¼ˆ`quick-buffer-verification.js`ï¼‰

```bash
node test/quick-buffer-verification.js
```

- æ‰€æœ‰ç¼“å†²åŒºåˆ›å»ºæ–¹æ³•çš„å¿«é€ŸéªŒè¯
- JPEGã€PNGã€WebP å’Œç¼©ç•¥å›¾åˆ›å»ºçš„åŸºæœ¬åŠŸèƒ½æ£€æŸ¥
- è¾“å‡ºéªŒè¯å’Œæ–‡ä»¶ç”Ÿæˆ

#### **ç»¼åˆç¼“å†²åŒºæµ‹è¯•**ï¼ˆ`buffer-creation.test.js`ï¼‰

```bash
node test/buffer-creation.test.js
```

- æ‰€æœ‰ 7 ç§ç¼“å†²åŒºåˆ›å»ºæ–¹æ³•çš„è¯¦ç»†æµ‹è¯•
- è´¨é‡ã€å‹ç¼©å’Œè°ƒæ•´å¤§å°å‚æ•°éªŒè¯
- æ€§èƒ½åŸºå‡†æµ‹è¯•å’Œå¹¶è¡Œåˆ›å»º
- æ ¼å¼ç‰¹å®šé€‰é¡¹æµ‹è¯•ï¼ˆæ¸è¿›å¼ JPEGã€æ— æŸ WebP/AVIFã€TIFF å‹ç¼©ï¼‰

#### **è¾¹ç¼˜æƒ…å†µæµ‹è¯•**ï¼ˆ`buffer-edge-cases.test.js`ï¼‰

```bash
node test/buffer-edge-cases.test.js
```

- å†…å­˜ç®¡ç†å‹åŠ›æµ‹è¯•
- æç«¯å‚æ•°éªŒè¯
- å¤šä¸ªå¤„ç†å™¨å®ä¾‹
- æ ¼å¼é­”æœ¯å­—èŠ‚éªŒè¯
- èµ„æºæ¸…ç†éªŒè¯

#### **é›†æˆæµ‹è¯•**ï¼ˆ`buffer-integration.test.js`ï¼‰

```bash
npm test  # åŒ…æ‹¬é›†æˆæµ‹è¯•
```

- Mocha/Chai æ¡†æ¶é›†æˆ
- é€‚å½“çš„é”™è¯¯å¤„ç†éªŒè¯
- å¤šæ ¼å¼ä¸€è‡´æ€§æ£€æŸ¥
- å‚æ•°è¾¹ç•Œæµ‹è¯•

### ç¼“å†²åŒºæµ‹è¯•è¿è¡Œå™¨

**ç»Ÿä¸€æµ‹è¯•è¿è¡Œå™¨**ï¼ˆ`run-buffer-tests.js`ï¼‰

```bash
# è¿è¡Œæ‰€æœ‰ç¼“å†²åŒºæµ‹è¯•
node test/run-buffer-tests.js

# ä»…å¿«é€ŸéªŒè¯
node test/run-buffer-tests.js --quick-only

# ä»…ç»¼åˆæµ‹è¯•
node test/run-buffer-tests.js --comprehensive-only

# ä»…è¾¹ç¼˜æƒ…å†µ
node test/run-buffer-tests.js --edge-only

# å¤±è´¥æ—¶å¼ºåˆ¶ç»§ç»­
node test/run-buffer-tests.js --force
```

## å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
npm test
```

### è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶

```bash
# å¿«é€Ÿå†’çƒŸæµ‹è¯•
npm run test:quick

# æ‰€æœ‰ç»¼åˆæµ‹è¯•
npm run test:all

# ä¸ªåˆ«æµ‹è¯•ç±»åˆ«
npm run test:static
npm run test:errors
npm run test:buffers
npm run test:buffer-creation  # æ–°ç¼“å†²åŒºåˆ›å»ºæ–¹æ³•
npm run test:config

# ä¼ ç»Ÿç»¼åˆæµ‹è¯•
npm run test:comprehensive
```

### å‘½ä»¤è¡Œé€‰é¡¹

```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
node test/index.js [command]

# å¯ç”¨å‘½ä»¤ï¼š
node test/index.js quick     # å¿«é€ŸåŠŸèƒ½æ£€æŸ¥
node test/index.js smoke     # åŸºæœ¬å†’çƒŸæµ‹è¯•
node test/index.js static    # ä»…é™æ€æ–¹æ³•
node test/index.js errors    # ä»…é”™è¯¯å¤„ç†
node test/index.js buffers   # ä»…ç¼“å†²åŒºæ“ä½œ
node test/index.js config    # ä»…é…ç½®
node test/index.js full      # æ‰€æœ‰æµ‹è¯•ï¼ˆé»˜è®¤ï¼‰
```

## æµ‹è¯•è¦æ±‚

### åŸºæœ¬è¦æ±‚

- Node.js 14+
- LibRaw å·²ç¼–è¯‘å’Œé“¾æ¥
- åŸºæœ¬æµ‹è¯•ä¸éœ€è¦ç¤ºä¾‹æ–‡ä»¶

### å¢å¼ºæµ‹è¯•ï¼ˆå¯é€‰ï¼‰

- `sample-images/` ç›®å½•ä¸­çš„ RAW ç¤ºä¾‹æ–‡ä»¶
- æ”¯æŒçš„æ ¼å¼ï¼šCR2ã€CR3ã€NEFã€ARWã€RAFã€RW2ã€DNG
- è‡³å°‘ 1MB å¯ç”¨ç£ç›˜ç©ºé—´ç”¨äºè¾“å‡ºæ–‡ä»¶

### ç¤ºä¾‹æ–‡ä»¶ç»“æ„

```
project-root/
â”œâ”€â”€ sample-images/
â”‚   â”œâ”€â”€ sample.cr2      # ä½³èƒ½ RAW
â”‚   â”œâ”€â”€ sample.nef      # å°¼åº· RAW
â”‚   â”œâ”€â”€ sample.arw      # ç´¢å°¼ RAW
â”‚   â””â”€â”€ sample.dng      # Adobe DNG
â””â”€â”€ test/
    â””â”€â”€ output/         # ç”Ÿæˆçš„æµ‹è¯•è¾“å‡º
```

## æµ‹è¯•ç»“æœ

### é¢„æœŸè¾“å‡º

**å¿«é€Ÿæµ‹è¯•ï¼š**

```
âš¡ LibRaw å¿«é€Ÿæµ‹è¯•
==============================
ğŸ“Š åº“ä¿¡æ¯ï¼š
   ç‰ˆæœ¬: 0.21.4
   ç›¸æœº: 1181
ğŸ—ï¸ æ„é€ å‡½æ•°æµ‹è¯•ï¼š
   âœ… LibRaw å®ä¾‹å·²åˆ›å»º
   âœ… å®ä¾‹å·²å…³é—­

ğŸ‰ å¿«é€Ÿæµ‹è¯•é€šè¿‡ï¼
```

**ç»¼åˆæµ‹è¯•æ‘˜è¦ï¼š**

```
ğŸ“Š æµ‹è¯•å¥—ä»¶æ‘˜è¦
============================================================
æ€»æµ‹è¯•å¥—ä»¶: 4
âœ… é€šè¿‡: 4
âŒ å¤±è´¥: 0
æˆåŠŸç‡: 100.0%
æ€»æŒç»­æ—¶é—´: 12.34s
å®Œæˆæ—¶é—´: 2025-08-23T10:30:00.000Z

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ğŸ‰
LibRaw åŒ…è£…å™¨å·¥ä½œæ­£å¸¸ã€‚
```

### æ€§èƒ½åŸºå‡†

ç°ä»£ç¡¬ä»¶ä¸Šçš„å…¸å‹æ€§èƒ½ï¼š

- **é™æ€æ–¹æ³•**: <100ms
- **é”™è¯¯å¤„ç†**: 500-1000ms
- **ç¼“å†²åŒºæ“ä½œ**: 1-5sï¼ˆå–å†³äºå¯ç”¨å†…å­˜ï¼‰
- **é…ç½®**: 200-500ms
- **ç»¼åˆ**: 5-15sï¼ˆä½¿ç”¨çœŸå® RAW æ–‡ä»¶ï¼‰

## æµ‹è¯•æ•°æ®

### åˆæˆæµ‹è¯•æ•°æ®

å½“çœŸå® RAW æ–‡ä»¶ä¸å¯ç”¨æ—¶ï¼Œæµ‹è¯•ä¼šè‡ªåŠ¨ç”Ÿæˆåˆæˆæ•°æ®ï¼š

- ç©ºç¼“å†²åŒº
- æ¨¡å¼å¡«å……ç¼“å†²åŒº
- å¤§å†…å­˜åˆ†é…
- æ— æ•ˆæ–‡ä»¶æ ¼å¼

### çœŸå® RAW æ–‡ä»¶æµ‹è¯•

å½“ç¤ºä¾‹æ–‡ä»¶å¯ç”¨æ—¶ï¼Œæµ‹è¯•æ‰§è¡Œï¼š

- å®é™… RAW å¤„ç†
- å…ƒæ•°æ®æå–éªŒè¯
- å›¾åƒå¤„ç†ç®¡é“
- è¾“å‡ºæ–‡ä»¶ç”Ÿæˆ
- æ€§èƒ½æµ‹é‡

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **"No file loaded" é”™è¯¯**

   - éœ€è¦åŠ è½½æ–‡ä»¶çš„æ–¹æ³•çš„é¢„æœŸè¡Œä¸º
   - æµ‹è¯•éªŒè¯é€‚å½“çš„é”™è¯¯å¤„ç†

2. **ç¼ºå°‘ç¤ºä¾‹æ–‡ä»¶**

   - æµ‹è¯•ä¼˜é›…åœ°å¤„ç†ç¼ºå°‘çš„ç¤ºä¾‹æ–‡ä»¶
   - ä½¿ç”¨åˆæˆæ•°æ®ä½œä¸ºåå¤‡

3. **å†…å­˜åˆ†é…é”™è¯¯**

   - å¤§ç¼“å†²åŒºæµ‹è¯•å¯èƒ½åœ¨ä½å†…å­˜ç³»ç»Ÿä¸Šå¤±è´¥
   - æµ‹è¯•åŒ…æ‹¬å†…å­˜å‹åŠ›åœºæ™¯

4. **LibRaw ç¼–è¯‘é—®é¢˜**
   - ç¡®ä¿ LibRaw åº“å·²æ­£ç¡®ç¼–è¯‘
   - æ£€æŸ¥ `npm run build` æˆåŠŸå®Œæˆ

### è°ƒè¯•æ¨¡å¼

ä¸ºæµ‹è¯•æ·»åŠ è°ƒè¯•è¾“å‡ºï¼š

```javascript
// è®¾ç½®ç¯å¢ƒå˜é‡ä»¥è·å–è¯¦ç»†è¾“å‡º
process.env.DEBUG = "1";
```

### æ€§èƒ½é—®é¢˜

å¦‚æœæµ‹è¯•è¿è¡Œç¼“æ…¢ï¼š

```bash
# è¿è¡Œè¾ƒè½»çš„æµ‹è¯•å¥—ä»¶
npm run test:quick

# è·³è¿‡å†…å­˜å¯†é›†å‹æµ‹è¯•
npm run test:static
npm run test:config
```

## è´¡çŒ®æµ‹è¯•

### æ·»åŠ æ–°æµ‹è¯•

1. åœ¨ `test/` ç›®å½•ä¸­åˆ›å»ºæµ‹è¯•æ–‡ä»¶
2. éµå¾ªå‘½åçº¦å®šï¼š`feature-name.test.js`
3. å¯¼å‡ºæµ‹è¯•å‡½æ•°ä»¥ä¾›æµ‹è¯•è¿è¡Œå™¨ä½¿ç”¨
4. å°†æµ‹è¯•æ·»åŠ åˆ° `test/index.js` ä¸»è¿è¡Œå™¨

### æµ‹è¯•ç»“æ„æ¨¡æ¿

```javascript
async function testFeatureName() {
  console.log("ğŸ”§ åŠŸèƒ½åç§°æµ‹è¯•");
  console.log("=".repeat(40));

  try {
    // æµ‹è¯•å®ç°
    console.log("   âœ… æµ‹è¯•é€šè¿‡");
  } catch (error) {
    console.log(`   âŒ æµ‹è¯•å¤±è´¥: ${error.message}`);
  }
}

module.exports = { testFeatureName };
```

### æµ‹è¯•æŒ‡å—

1. **é”™è¯¯å¤„ç†**ï¼šå§‹ç»ˆæµ‹è¯•æˆåŠŸå’Œå¤±è´¥æƒ…å†µ
2. **èµ„æºæ¸…ç†**ï¼šä½¿ç”¨ `finally` å—ç¡®ä¿é€‚å½“çš„æ¸…ç†
3. **æ¸…æ™°è¾“å‡º**ï¼šä½¿ç”¨è¡¨æƒ…ç¬¦å·å’Œæ ¼å¼ä»¥è·å¾—å¯è¯»çš„ç»“æœ
4. **æ€§èƒ½**ï¼šä¸ºæ€§èƒ½æ•æ„Ÿçš„æµ‹è¯•åŒ…å«è®¡æ—¶
5. **éªŒè¯**ï¼šéªŒè¯ç»“æœï¼Œè€Œä¸ä»…ä»…æ˜¯æ£€æŸ¥æ²¡æœ‰é”™è¯¯

## æŒç»­é›†æˆ

### GitHub Actions é›†æˆ

```yaml
- name: è¿è¡Œ LibRaw æµ‹è¯•
  run: |
    npm install
    npm run test:smoke
    npm run test:all
```

### æµ‹è¯•è¦†ç›–

æµ‹è¯•å¥—ä»¶æ¶µç›–ï¼š

- âœ… æ‰€æœ‰å…¬å…± API æ–¹æ³•ï¼ˆ30+ å‡½æ•°ï¼‰
- âœ… é”™è¯¯æ¡ä»¶å’Œè¾¹ç¼˜æƒ…å†µ
- âœ… å†…å­˜ç®¡ç†å’Œæ¸…ç†
- âœ… å‚æ•°éªŒè¯
- âœ… è·¨å¹³å°å…¼å®¹æ€§
- âœ… æ€§èƒ½ç‰¹å¾

## è®¸å¯è¯

æµ‹è¯•åœ¨ä¸»è¦é¡¹ç›®çš„ç›¸åŒ MIT è®¸å¯è¯ä¸‹æä¾›ã€‚
